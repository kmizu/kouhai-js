# 第23話 記憶する関数、クロージャ

「関数が、自分が生まれた時の『世界』を記憶しているって言っただろ？　それが、クロージャの正体だ」

　僕は、美久の目の前に、少し複雑なコードを打ち込んだ。

```javascript
['define', 'make-adder',
  ['lambda', ['n'],
    ['lambda', ['x'], ['+', 'x', 'n']]
  ]
]
```

「これは、『`make-adder`』という名前の関数を定義している。この関数は、`n`という数字を受け取ると、**新しい関数**を返すんだ」
「え、関数が関数を返すんですか！？」

　美久が、目を丸くして驚いている。無理もない。初めて聞けば、誰もがそう反応するだろう。

「ああ。そして、その返された新しい関数は、`x`という数字を受け取って、`x`に、最初に`make-adder`に渡した`n`を足し算する。つまり、『特定の数を足すだけの関数』を、自由に作れるようになるんだ」

　僕は、さらにコードを書き足した。

```javascript
['define', 'add5', ['make-adder', 5]]
['define', 'add10', ['make-adder', 10]]

['add5', 3]  // -> 8
['add10', 3] // -> 13
```

「`make-adder`に`5`を渡して作られた関数は、いつでも`5`を足してくれる。`10`を渡して作られた関数は、いつでも`10`を足してくれる。この`add5`や`add10`が、まさに『クロージャ』なんだ」

　美久は、画面のコードと僕の顔を交互に見ながら、真剣な表情で考え込んでいる。

「つまり……`add5`っていう関数は、自分が作られた時に『`n`は`5`だった』っていうのを、ずっと覚えてるってことですか？」
「その通りだ！　すごいな、美久！」

　僕は、思わず声を上げた。彼女は、この複雑な概念の核心を、見事に捉えたのだ。

「`add5`が呼び出された時、その関数は、自分が生まれた時の『世界』を親とする新しい世界を作る。その『生まれた時の世界』には、`n`が`5`だという情報が記憶されているから、`add5`は、いつでも`5`を足すことができるんだ」

　僕は、この仕組みが、プログラミングにおける「状態の保持」や「プライベートなデータ」を扱う上で、いかに強力なツールであるかを説明した。

「相沢のヤツが言ってた『クロージャ』は、まさにこれだ。関数が、自分が生まれた時の環境を『閉じて（close）』記憶しているから、クロージャって呼ばれるんだ」

　美久は、しばらく黙って画面を見つめていたが、やがて、ゆっくりと顔を上げた。その瞳には、深い理解と、そして、ある種の感動が宿っていた。

「先輩……なんだか、すごく、ロマンチックですね」
「ロマンチック？」

　僕が聞き返すと、彼女は少し照れたように、でも、はっきりと頷いた。

「だって、関数が、自分が生まれた時のことを、ずっと覚えてるなんて……。まるで、大切な思い出を、ずっと心の中にしまっておくみたいで」

　その言葉に、僕ははっとした。僕にとっては、ただの技術的な概念だった「クロージャ」が、彼女の感性を通して、全く別の、温かい意味を帯びて見えたのだ。

「そうか……。ロマンチック、か」

　僕たちの言語は、ただの計算機から、記憶を持ち、感情すら宿すかのような、不思議な存在へと進化していた。そして、その進化の過程で、僕たちの間にも、言葉では言い表せない、確かな「記憶」が、積み重なっていく。

　僕たちの「クロージャ」は、これからも、たくさんの思い出を、心の中に「閉じて」いくのだろう。そんな予感が、僕の胸を温かく満たした。