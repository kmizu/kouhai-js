# 第3話 最初の評価器（Evaluator）

「この暗号みたいなリストを、コンピュータに計算させてあげる、ね……」

　週が明けた放課後。僕たちは学校の空き教室にいた。美久は目の前のノートパソコンに表示された `['+', 1, 2]` という文字列を眺めながら、うーんと唸っている。

「でも、どうやって？　コンピュータに、このリストの読み方を教えてあげないといけないんですよね？」
「その通りだ。その『読み方を教えるプログラム』のことを、専門用語で**評価器（Evaluator）**って言うんだ」
「ひょうかき……」

　なんだか急に難しそうな言葉が出てきて、美久は少しだけ身構えたようだ。僕は慌てて付け加える。

「大丈夫。難しく考える必要はない。美久が前に言ってた、『翻訳機』みたいなものだと思えばいい。僕たちの作った『お願い』のルールを、コンピュータがわかる形に翻訳してあげる機械だ」
「なるほど……！　翻訳機！」

　その言葉で少し安心したのか、彼女の表情が和らいだ。僕はノートパソコンに向き直り、JavaScriptのファイルを開く。

「じゃあ、その翻訳機を実際に作ってみよう。`evaluate`っていう名前をつけてやる」

　僕はそう言って、数行のコードを打ち込んだ。

```javascript
function evaluate(exp) {
  // ここに翻訳のルールを書いていく
}
```

「まず、一番簡単なルールからだ。『もし、お願いがただの数字だったら、それは計算する必要がないから、そのままその数字を返す』。これをコードにすると、こうなる」

```javascript
function evaluate(exp) {
  if (typeof exp === 'number') {
    return exp;
  }
}
```

「`typeof`っていうのは、そのデータがどんな種類かを調べる命令だ。この場合は、『もし`exp`が数字だったら』っていう意味になる」
「へえー。じゃあ、`evaluate(5)`ってお願いしたら、`5`がそのまま返ってくるってことですか？」
「正解。じゃあ、次が本番だ。『もし、お願いが `['+', 1, 2]` みたいなリストだったら』どうするか」

　僕はコードを書き足していく。

```javascript
function evaluate(exp) {
  if (typeof exp === 'number') {
    return exp;
  }

  if (Array.isArray(exp)) {
    const operator = exp[0]; // リストの1番目（演算子）
    const operand1 = exp[1]; // リストの2番目（数字1）
    const operand2 = exp[2]; // リストの3番目（数字2）

    if (operator === '+') {
      return evaluate(operand1) + evaluate(operand2);
    }
  }
}
```

「`Array.isArray(exp)`っていうので、`exp`がリストかどうかを調べてる。そして、リストの1番目が `+` だったら、2番目と3番目の数字を足し算する、っていうルールだ」
「あ、なるほど……。でも、先輩。最後の行、ちょっと不思議です」

　美久が指さしたのは、`return evaluate(operand1) + evaluate(operand2);` の部分だった。

「`evaluate`の中で、また`evaluate`を呼んでますよね？　それって、アリなんですか？」
「よく気づいたな。それが一番大事なポイントだ」

　僕は彼女に向き直った。

「翻訳機は、リストの中身がまた計算できるものかもしれないって考えるんだ。だから、2番目の`operand1`と3番目の`operand2`を、もう一度自分自身に『これ、翻訳して』ってお願いする。そうやって、どんどん中身を解き明かしていくんだ」
「なんだか……玉ねぎの皮をむいていくみたいですね。むいてもむいても、また自分が出てくる、みたいな」
「はは、面白い例えだな。でも、そんな感じだ。自分の仕事を、自分自身に依頼して、問題を少しずつ簡単にしていく。プログラミングの、すごく重要な考え方の一つだよ」

　美久は「ふーむ」と腕を組み、何かを深く納得したような顔をしている。彼女のこういう、物事の本質を直感で掴み取るところには、時々驚かされる。

「じゃあ、いよいよ、こいつを動かしてみようか」

　僕はプログラムの最後に、一行を追加した。

`console.log(evaluate(['+', 1, 2]));`

　エンターキーを押す。一瞬の沈黙の後、画面の片隅に、ぽつんと一つの数字が表示された。

`3`

「……あ」

　美久が、小さな声を漏らした。

「動きましたね……先輩」
「ああ。動いたな」

　僕たちの最初の言語が、産声を上げた瞬間だった。たった一つの計算しかできない、世界で一番小さな言語。でも、それは紛れもなく、僕たちが「作った」ものだった。

「すごい……！　たったこれだけのコードで、ちゃんと計算できるんですね！」

　興奮した様子で画面を覗き込む彼女の横顔を見ながら、僕は静かな達成感を噛み締めていた。

「ああ。でもな、美久」
「はい？」
「これが、全ての始まりなんだ」

　僕の言葉に、彼女はきょとんとした顔で僕を見つめ、そして、次の瞬間には、満面の笑みで力強く頷いたのだった。