# 第21話 関数という名の「箱」

　相沢の挑発を受けてから、僕たちの開発作業は、以前にも増して熱を帯びていた。特に美久の目の輝きは、まるで新しいおもちゃを見つけた子どものようだ。

「先輩！　関数って、どうやって作るんですか？　早く、あの人をぎゃふんと言わせたいです！」

　目を輝かせながら、美久が前のめりになる。その純粋な闘志に、僕も思わず笑みがこぼれた。

「よし、じゃあ今日は、僕たちの言語に『関数』という概念を導入するぞ。まずは、関数の『定義』からだ」

　僕は、エディタに`lambda`を使った関数の定義を打ち込んだ。

`['lambda', ['x', 'y'], ['+', 'x', 'y']]`

「これが、僕たちの言語における関数の形だ。`lambda`っていうのは、『ここから関数が始まるよ』っていう合図。その次に来るのが、`['x', 'y']`みたいに、関数が受け取る『引数』（ひきすう）のリスト。そして、最後が、関数が実際にやる『処理』（ボディ）だ」
「ふむふむ……。なんだか、お弁当箱みたいですね！」

　美久が、また独特の例えを出してきた。

「引数が、お弁当の中身。ボディが、その中身をどう調理するか、みたいな？」
「……面白いな。まあ、そんな感じだ。この『お弁当箱』を、僕たちの`evaluate`関数でどう扱うか、考えてみよう」

　僕は`evaluate`関数に、`lambda`を処理するための新しい分岐を追加した。

```javascript
    if (exp[0] === 'lambda') {
      const params = exp[1]; // 引数のリスト
      const body = exp[2];   // 関数の本体（処理）
      // ここで関数オブジェクトを作る
      return { type: 'function', params: params, body: body, env: env };
    }
```

「`lambda`を見つけたら、僕たちの`evaluate`関数は、特別な『関数オブジェクト』っていうものを作るんだ。これは、ただの数字や文字列とは違って、`type`が`'function'`で、引数と本体、そして、**その関数が作られた時の『世界（環境）』**を記憶している」
「え、環境もですか？」
「ああ。これが、後で出てくる『クロージャ』の肝になる部分だ。関数は、自分が生まれた時の世界を、まるで写真に撮るみたいに、まるごと記憶しているんだ」

　美久は「ふーむ」と腕を組み、少し難しい顔をしている。まだピンと来ていないようだが、その真剣な表情は、僕の言葉を一つも聞き漏らすまいとしている証拠だ。

「じゃあ、この関数オブジェクトを、変数に代入してみよう。例えば、`add`っていう名前で」

`['define', 'add', ['lambda', ['x', 'y'], ['+', 'x', 'y']]]`

「これで、僕たちの言語は、`add`という名前で、二つの数を足し算する関数を『覚えた』ことになる。でも、これだけじゃまだ、関数は動かない。次に必要なのは、その関数を『呼び出す』仕組みだ」

　僕は、関数の定義と呼び出しが、プログラミング言語の根幹をなすことを説明した。そして、美久の顔を見ると、彼女の瞳には、すでに次のステップへの期待が満ち溢れているのが分かった。

「先輩、なんだか、すごくワクワクします！」

　その言葉に、僕の胸にも、熱いものがこみ上げてきた。僕たちの言語は、ただの計算機から、いよいよ、本物の「言葉」へと進化しようとしている。そして、その進化の過程を、美久と二人で歩めることが、何よりも嬉しかった。