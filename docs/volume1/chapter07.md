# 第7話 パーサーは後回し

　四月二十六日、金曜日。放課後。

　今日の美久は、なんだかそわそわしている。

「どうしたの？　落ち着かないみたいだけど」

「だって、今日はMikuLangの構文を決めるんでしょ？」

　美久が大きなノートを取り出す。付箋がたくさん貼られていて、びっしりとアイデアが書き込まれている。

「すごい準備……」

「昨日、眠れなくて。いろいろ考えてたら朝になっちゃった」

　その熱意に圧倒される。でも、目の下にうっすらクマができているのが心配だ。

「無理しなくていいのに」

「無理じゃないよ。楽しかったから」

　美久の笑顔を見て、僕も嬉しくなる。

◇◇◇◇

「まず、構文を決める前に大事な話がある」

　僕はホワイトボードに「パーサー」と書いた。

「パーサーって？」

「文字列をASTに変換するプログラムのこと」

　簡単な図を描いて説明する。

```
"1 + 2" → パーサー → AST
```

「なるほど。文字を読んで、木構造を作るんだ」

「そう。でも、パーサーを作るのはかなり大変なんだ」

　美久が首を傾げる。

「どのくらい大変？」

「うーん……」

　僕は考えながら説明を始めた。

「例えば、『1 + 2 * 3』をパースする時、演算子の優先順位を考慮しないといけない」

「あ、掛け算が先」

「そう。それに、括弧とか、エラー処理とか、考えることがたくさんある」

◇◇◇◇

「でも」

　僕は美久に向き直った。

「今回は、パーサーを作らない」

「え？」

　美久が驚いた顔をする。

「じゃあ、どうやって……」

「JavaScriptで直接ASTを書くんだ」

　コードを書いて見せる。

```javascript
// MikuLangの構文（案）
// もしも x が 5 より大きい ならば
const ifStatement = {
  type: 'IfStatement',
  condition: {
    type: 'BinaryExpression',
    operator: '>',
    left: { type: 'Identifier', name: 'x' },
    right: { type: 'NumberLiteral', value: 5 }
  },
  then: {
    // 処理
  }
};
```

「これって、手動でAST作ってるってこと？」

「その通り。構文解析を飛ばして、意味解析に集中できる」

◇◇◇◇

「なるほど！」

　美久が目を輝かせる。

「料理で言うと、材料の下ごしらえは後回しにして、味付けから始める感じ？」

　また的確な例えだ。

「そう。本質的な部分から作っていく」

「でも、最終的にはパーサーも必要なんでしょ？」

「うん。でも、それは言語の仕様が固まってからでいい」

　美久が納得したように頷く。

「確かに、何を作るか決まってないのに、作り方を考えても仕方ないもんね」

◇◇◇◇

「それじゃあ、構文のアイデアを聞かせて」

　美久がノートを開く。

「まず、日本語で書けるようにしたい！」

「いいね。どんな感じ？」

　美久が書いたサンプルコードを見せてくれた。

```
もしも 好感度 が 80 以上 ならば
    「告白成功！」を表示
そうでなければ
    「もっと仲良くなろう」を表示
```

「わあ、読みやすい」

「でしょ？　初心者でも理解しやすいと思うの」

　確かに、英語のif-elseより親しみやすい。

「これをASTで表現すると……」

　僕はコードを書き始めた。

```javascript
const mikuLangIf = {
  type: 'IfStatement',
  condition: {
    type: 'BinaryExpression',
    operator: '>=',
    left: { type: 'Identifier', name: '好感度' },
    right: { type: 'NumberLiteral', value: 80 }
  },
  then: {
    type: 'PrintStatement',
    value: { type: 'StringLiteral', value: '告白成功！' }
  },
  else: {
    type: 'PrintStatement',
    value: { type: 'StringLiteral', value: 'もっと仲良くなろう' }
  }
};
```

◇◇◇◇

「ねえ、隆弘先輩」

　作業中、美久が顔を上げた。

「変数の宣言はどうする？」

「どんなアイデアがある？」

　美久がノートのページをめくる。

```
好感度 を 0 にする
名前 を 「美久」 にする
```

「『にする』かあ。分かりやすいね」

「letとかvarとか、初心者には意味不明だもん」

　その通りだ。プログラミング言語の予約語は、英語圏でも分かりにくいことがある。

「じゃあ、代入もこんな感じ？」

```
好感度 に 10 を足す
好感度 を 2倍 にする
```

「いいね！　自然な日本語だ」

◇◇◇◇

　しばらく議論を続けていると、美久が突然立ち上がった。

「あ、そうだ！」

「どうした？」

「関数の呼び出しも日本語にしたい」

　美久がホワイトボードに書く。

```
美久の好感度を上げる（10）
隆弘に告白する（）
```

　なんだか例が具体的すぎる気がするけど……。

「括弧はそのまま？」

「うーん、どうしよう」

　二人で考え込む。

「『〜に10を渡して実行』とか？」

「長いなあ」

　試行錯誤を繰り返す。こういう時間が楽しい。

◇◇◇◇

　休憩時間。自販機でジュースを買って戻ると、美久が窓の外を眺めていた。

「何考えてるの？」

「パーサーを作らないって、勇気がいる決断だよね」

　意外な言葉だった。

「どうして？」

「だって、普通は最初から順番に作るものでしょ？」

「確かに」

　美久が振り返る。

「でも、隆弘先輩は本質を見極めて、必要なところから作る。すごいと思う」

　褒められて照れる。

「研究でも同じなんだ。完璧を求めすぎると、何も進まない」

「完璧じゃなくていいんだ」

「うん。まず動くものを作って、それから改善していく」

　美久が優しく微笑む。

「なんか、人生みたい」

◇◇◇◇

　作業を再開して、構文の詳細を詰めていく。

「ループはどうする？」

「『〜の間、繰り返す』とか？」

```
好感度 が 100 未満 の間、繰り返す
    デートに誘う（）
    好感度 に 5 を足す
繰り返し終わり
```

「ちょっと例が……」

「あ、いや、これは一般的な例で！」

　美久が慌てて弁解する。顔が真っ赤だ。

（かわいい）

　そんなことを考えてしまう自分に気づいて、僕も顔が熱くなる。

◇◇◇◇

　夕方六時。今日も充実した時間だった。

「構文の基本的な方向性は決まったね」

「うん！　日本語で書けるプログラミング言語」

　美久が満足そうに頷く。

「来週は、これをちゃんと動くようにしよう」

「楽しみ！」

　荷物をまとめながら、美久が言った。

「ねえ、隆弘先輩」

「ん？」

「パーサーを後回しにしたのは、私のためでもあるの？」

　鋭い質問に、少し戸惑う。

「どういうこと？」

「だって、パーサーから作ったら、私にはついていけないでしょ？」

（バレてたか）

　正直、それも理由の一つだった。美久が楽しく学べるように、順番を工夫したのは事実だ。

「……そうかもしれない」

「やっぱり」

　美久が嬉しそうに笑う。

「隆弘先輩、優しい」

　また『優しい』と言われた。でも、今回は素直に受け取ることにした。

◇◇◇◇

　帰り道。

「週末はどうする？」

　僕が聞くと、美久が驚いた顔をした。

「え？」

「プログラミングの続き、やる？」

「もちろん！　でも、隆弘先輩の都合は？」

「大丈夫。研究も一段落ついたし」

　本当は、美久との時間を優先したいだけなんだけど。

「じゃあ、明日の午後でもいい？」

「うん。僕の部屋でいい？」

　美久の顔がまた赤くなる。

「は、はい」

　なんだか、デートの約束をしているみたいだ。

（いや、プログラミングの勉強会だから）

　自分に言い聞かせるけど、胸の高鳴りは止まらない。

　明日は土曜日。二人きりで、ゆっくりコードを書ける。

　MikuLangの実装も、美久との関係も、少しずつ前に進んでいる。

　その実感を噛みしめながら、僕は家路についた。