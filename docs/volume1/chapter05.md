# 第5話 コードのお掃除と、新しい道具箱

「これって、パターンじゃないですか？」

　美久がそう指摘してから数日後の放課後。僕たちは再び、空き教室の机に向かい合っていた。
　彼女の言葉が、僕の頭の中でずっと反響していた。そうだ、彼女はもう、ただ言われた通りにコードをなぞるだけの初心者じゃない。自分自身の目で、コードの中に潜む構造を見つけ出したんだ。

「美久の言う通りだ。そしてな、良いプログラマっていうのは、そのパターンを見つけたら、もっと綺麗に『お掃除』したくなるものなんだ」
「お掃除、ですか？」
「ああ。今の僕たちの`evaluate`関数は、`if`文がずらずらと並んでいて、少し散らかっている。これを、もっとすっきりと片付けたい。専門用語で**リファクタリング**って言う」

　僕は、現在のコードの問題点を指摘した。

「例えば、『あまりを求める計算』とか、新しい演算子を追加したくなったらどうする？」
「えーと……また、同じような`if`文を書き足します」
「そうだよな。一つ増やすたびに、どんどんコードが長くなっていく。それは、あまり美しくない」

　美しくない、という僕の言葉に、美久は少し意外そうな顔をした。プログラミングと美意識が、彼女の中でまだ結びついていないのだろう。

「じゃあ、どうすれば……」
「美久なら、どうする？」

　僕が問いかけると、彼女はうーんと腕を組んで考え込んだ。そして、しばらくして、ぽつりと言った。

「最初に……その、演算子のマークと、それがどんな計算をするのかっていう、『対応表』みたいなものを作っておく、とか……？」

　僕は、思わず息を呑んだ。完璧な答えだった。

「……すごいな、美久。本当に、その通りだ」
「え、本当ですか！？」
「ああ。プログラミングの世界では、そういう『対応表』のことを、**マップ**とか**辞書**とか呼ぶ。僕たちの言語が使う『計算道具』を、一つの道具箱にまとめておくようなイメージだ」

　僕はそう言って、新しいコードを書き始めた。`operations`という名前の、僕たちの「道具箱」だ。

```javascript
const operations = {
  '+': (a, b) => a + b,
  '-': (a, b) => a - b,
  '*': (a, b) => a * b,
  '/': (a, b) => a / b,
};
```

「うわ、なんだか矢印がいっぱい……」
「はは。今は、『処理を表す矢印』くらいに思っておけば大丈夫だ。大事なのは、`+`っていう記号と、『二つの数を足す処理』が、ここでペアになってるってことだ」

　そして、僕はこの新しい「道具箱」を使って、あれだけ長かった`evaluate`関数を書き換えてみせた。

```javascript
// リストの場合の処理
const operator = exp[0];
const operand1 = exp[1];
const operand2 = exp[2];

// 道具箱から、演算子に合った道具（関数）を取り出す
const func = operations[operator];

// もし、使える道具があったら、それを使って計算する
if (func) {
  return func(evaluate(operand1), evaluate(operand2));
}
```

「え……」

　美久が、呆然とした声を上げた。あれだけ並んでいた`if`文が、たった数行のコードに置き換わってしまったのだから。

「すごい……！　すっきりした！　なんだか、魔法みたいです！」
「これは魔法じゃない。ただ、僕たちがやるべき『仕事（処理）』と、そのための『道具（データ）』を、きちんと分けて整理しただけなんだ」

　プログラミングは、ただ処理を書き連ねることじゃない。データを、いかに分かりやすく、使いやすい「構造」で整理するかが、同じくらい、いや、時にはそれ以上に重要なんだ。

「コードを綺麗にするのって……なんだか、すごく気持ちいいですね」

　すっかり片付いたコードを眺めながら、美久が満足そうに呟いた。その横顔を見て、僕は静かに微笑んだ。
　彼女はもう、プログラミングの表面的な楽しさだけじゃなく、その奥にある構造的な美しさにも、足を踏み入れ始めていた。

　僕たちの言語が、また一つ、美しく、そして強くなった。そんな確かな手応えが、僕たちの間に満ちていた。