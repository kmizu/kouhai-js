# 第5話 ASTって何？

　四月二十四日、水曜日。放課後。

　今日も美久は早めに情報処理室に来ていた。机の上には、手作りの図解ノートが広げられている。

「今日も早いね」

「だって、ASTについてもっと詳しく知りたくて」

　美久がノートを見せてくれる。昨日までのコードを元に、自分なりにASTの構造を図にしたらしい。

「すごい。もう理解してるじゃない」

「でも、まだよく分からないところがあって……」

　美久が困った顔で図の一部を指差す。

「この木構造って、どうやって決まるの？」

◇◇◇◇

「いい質問だね。じゃあ、今日はASTについて深く掘り下げてみよう」

　僕はホワイトボードに向かった。

「ASTは Abstract Syntax Tree の略。日本語だと抽象構文木」

「抽象……構文……木？」

　美久が首を傾げる。

「一つずつ説明するね。まず『木』から」

　僕は簡単な木の絵を描いた。

```
        +
       / \
      1   *
         / \
        2   3
```

「これが 1 + 2 * 3 のAST」

「あ、昨日やったやつ！」

「そう。でも、なんでこういう形になるか分かる？」

　美久が考え込む。

「えっと……掛け算が先だから？」

「正解。演算子の優先順位で木の形が決まるんだ」

◇◇◇◇

「じゃあ、実際にASTがどう作られるか見てみよう」

　僕は新しいコードを書き始めた。

```javascript
// ASTを手動で作る関数
function createBinaryExpression(operator, left, right) {
  return {
    type: 'BinaryExpression',
    operator: operator,
    left: left,
    right: right
  };
}

function createNumberLiteral(value) {
  return {
    type: 'NumberLiteral',
    value: value
  };
}

// 1 + 2 を作る
const onePlusTwo = createBinaryExpression(
  '+',
  createNumberLiteral(1),
  createNumberLiteral(2)
);

console.log(JSON.stringify(onePlusTwo, null, 2));
```

「わあ、関数で作れるんだ」

「そう。こうすると構造が分かりやすいでしょ？」

　美久が熱心にメモを取る。

「でも、これって手動で作るの大変じゃない？」

「その通り。だから本来は構文解析器（パーサー）が自動で作るんだけど……」

「今回は飛ばすんだよね」

　美久が昨日の話を覚えていてくれた。

◇◇◇◇

「ところで」

　美久が顔を上げた。

「抽象って何？　具体的じゃないってこと？」

　また鋭い質問だ。

「うーん、説明が難しいんだけど……」

　僕は考えながら話し始めた。

「例えば、『1 + 2』って書き方はいろいろあるよね」

「いろいろ？」

「日本語なら『1足す2』、英語なら『one plus two』」

「あ、なるほど」

「でも、どの書き方でも『足し算』という本質は同じ。その本質的な構造を表現したのがAST」

　美久が目を輝かせる。

「つまり、見た目じゃなくて意味を表してるんだ」

「まさにその通り！」

　美久の理解力に、また感心してしまう。

◇◇◇◇

「じゃあ、もっと複雑なASTを作ってみよう」

　僕は新しい例を書き始めた。

```javascript
// (1 + 2) * (3 + 4) のAST
const complexAst = createBinaryExpression(
  '*',
  createBinaryExpression(
    '+',
    createNumberLiteral(1),
    createNumberLiteral(2)
  ),
  createBinaryExpression(
    '+',
    createNumberLiteral(3),
    createNumberLiteral(4)
  )
);

// 評価
console.log(evaluate(complexAst)); // 21
```

「おお、ちゃんと計算できてる！」

「ASTさえ正しく作れば、どんな複雑な式でも評価できるんだ」

　美久が感心したように頷く。

「でも、隆弘先輩」

「ん？」

「これって、プログラミング言語としてはまだ計算しかできないよね」

　その通りだ。美久は本質を理解している。

「そう。だから次は変数とか、もっと高度な機能を——」

「待って」

　美久が遮った。

「その前に、今のASTをもっと見やすくしたい」

◇◇◇◇

「見やすく？」

「うん。JSON.stringifyだと読みにくいから、もっと綺麗に表示したい」

　なるほど、視覚的に理解したいということか。

「じゃあ、AST を綺麗に表示する関数を作ろう」

```javascript
function printAst(node, indent = '') {
  if (node.type === 'NumberLiteral') {
    console.log(indent + `Number: ${node.value}`);
  } else if (node.type === 'BinaryExpression') {
    console.log(indent + `Binary: ${node.operator}`);
    printAst(node.left, indent + '  ');
    printAst(node.right, indent + '  ');
  }
}

// 使ってみる
printAst(complexAst);
```

　実行すると、こんな出力になった。

```
Binary: *
  Binary: +
    Number: 1
    Number: 2
  Binary: +
    Number: 3
    Number: 4
```

「わあ、木の形が見える！」

　美久が嬉しそうに声を上げる。

「インデントで階層を表現してるんだ」

「そう。これなら構造が一目で分かるでしょ？」

◇◇◇◇

　しばらく作業を続けていると、美久がふと手を止めた。

「ねえ、隆弘先輩」

「どうした？」

「ASTって、人間の考え方に似てない？」

　意外な発言に、僕は手を止めた。

「どういうこと？」

「だって、私たちも計算する時、無意識に優先順位を考えて、頭の中で構造化してるでしょ？」

（確かに……）

　美久の洞察力に驚く。コンピュータサイエンスの本質的な部分に気づいている。

「美久、それすごい気づきだよ」

「本当？」

「うん。実際、ASTは人間の思考プロセスをモデル化したものとも言える」

　美久が嬉しそうに微笑む。その笑顔を見ていると、教えている僕も楽しくなってくる。

◇◇◇◇

「休憩にしよう」

　窓を開けると、春の風が入ってきた。

「もう五時か」

「時間が経つの早いね」

　美久が伸びをする。

「でも、今日でASTのことがよく分かった」

「それは良かった」

「隆弘先輩の説明、本当に分かりやすい」

　褒められて、少し照れる。

「美久の理解力が高いからだよ」

「そんなことない。先輩が丁寧に教えてくれるから」

　お互いを褒め合って、なんだか気恥ずかしくなる。

「あの……」

　美久が何か言いかけた時、廊下から足音が聞こえてきた。

「失礼します」

　ドアが開いて、情報科の先生が顔を出した。

「嵐山くん、まだいたのか」

「あ、はい。プログラミングの勉強を」

「熱心だね。でも、もうすぐ施錠時間だよ」

「分かりました。すぐ片付けます」

◇◇◇◇

　先生が去った後、急いで片付けを始める。

「明日は何をやるの？」

　美久が荷物をまとめながら聞いてくる。

「そうだな……ASTのバリエーションをもっと増やそうか」

「バリエーション？」

「文字列とか、真偽値とか。あと、単項演算子も」

「単項演算子？」

「マイナス記号みたいな、値を一つだけ取る演算子」

　美久がメモを取る。

「予習してくる！」

「そんなに頑張らなくても……」

「だって、早く本格的な言語を作りたいから」

　その熱意に、胸が温かくなる。

◇◇◇◇

　教室を出て、廊下を歩く。

「今日も楽しかった」

　美久がぽつりと言った。

「僕も」

　素直な返事が口をついて出た。

「隆弘先輩」

「ん？」

「明日も、よろしくお願いします」

　夕日に照らされた美久の横顔が、なんだか大人っぽく見えた。

「こちらこそ」

　昇降口で別れて、帰路につく。

　ASTの説明は、思ったよりスムーズに進んだ。美久の理解力と、鋭い質問のおかげだ。

　そして、美久との距離も——

（少しずつ、近づいてる気がする）

　明日は、もっと複雑なASTに挑戦する予定だ。

　美久なら、きっとすぐに理解してくれるだろう。

　そんな確信を持ちながら、僕は家路を急いだ。